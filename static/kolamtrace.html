<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KolamTrace | KolamVerse</title>
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/assets/kolamtrace.css" />
</head>

<body>
    <div class="trace-bar">
        <div class="brand">
            <svg class="kolam-svg" fill="none" viewBox="0 0 70 70">
                <circle cx="35" cy="35" r="32" stroke="#c00" stroke-width="2" />
                <ellipse cx="35" cy="35" rx="22" ry="22" stroke="#ffffff" stroke-width="2" />
                <path stroke="#c00" stroke-width="1.8" d="M12 35 Q35 10 58 35 Q35 60 12 35 Z" />
                <circle cx="35" cy="17" r="2" fill="#ffffff" />
                <circle cx="35" cy="53" r="2" fill="#ffffff" />
                <circle cx="17" cy="35" r="2" fill="#ffffff" />
                <circle cx="53" cy="35" r="2" fill="#ffffff" />
            </svg>
            <h1><a href="/">KolamVerse</a></h1>
        </div>
        <span class="section-title">KolamTrace</span>
    </div>

    <div class="main-flex">
        <div class="upload-side">
            <h2>1. Upload Kolam Image</h2>
            <div class="img-slot" id="preview-box">
                <img id="preview-img" class="hidden" src="" alt="Your image preview" />
                <span class="slot-placeholder" id="preview-placeholder">No image uploaded</span>
            </div>
            <label class="upload-label" for="kolam-upload">Choose Image
                <input type="file" id="kolam-upload" accept="image/*" />
            </label>
            <div class="info">JPG, PNG • Max 2MB</div>
        </div>
        <div class="right-side">
            <div class="anim-panel">
                <h2>2. Kolam Animation</h2>
                <div class="anim-area" id="anim-area">
                    <div class="anim-placeholder" id="anim-placeholder">Upload a Kolam image and press <b>Animate</b> to
                        view the tracing animation!</div>
                    <div class="shimmer-loader" id="shimmer-loader" style="display: none">
                        <div class="shimmer-content"></div>
                    </div>
                    <canvas id="animationCanvas" width="410" height="370"></canvas>
                </div>
                <br>
                <div class="actions">
                    <button id="animate-btn" disabled>Animate</button>
                    <button id="back20" disabled>&laquo; 20 Frames</button>
                    <label for="frameSlider" class="visually-hidden">Frame position</label>
                    <input type="range" id="frameSlider" min="0" max="0" value="0" class="flex-grow"
                        title="Frame position" />
                    <button id="forward20" disabled>20 Frames &raquo;</button>
                    <button id="show-curve" disabled>Show Mathematical Curve</button>
                    <button id="practicebtn" disabled>Practice</button>
                </div>
                <br>
                <div id="curve-panel" style="margin-top:18px; display:none; width:100%;">
                    <div style="display:flex; gap:18px; align-items:flex-start; flex-wrap:wrap;">
                        <div style="flex:1; min-width:280px; color:#c9d1d9;">
                            <h3 style="margin-top:0; color:#78f5c6;">Mathematical Curve (B‑spline)</h3>
                            <p style="margin:4px 0 6px 0; font-style:italic; color:#9ec6ae;">Derived from the traced CSV
                                points by fitting a cubic B‑spline x(t), y(t). Download JSON to view knots and
                                coefficients
                                for verification and digitization</p>
                            <p style="margin:6px 0 10px 0;">Parametric form per interval [t<sub>i</sub>,
                                t<sub>i+1</sub>]:<br>
                                x(t) = a<sub>xi</sub> + b<sub>xi</sub>τ + c<sub>xi</sub>τ² + d<sub>xi</sub>τ³;<br>
                                y(t) = a<sub>yi</sub> + b<sub>yi</sub>τ + c<sub>yi</sub>τ² + d<sub>yi</sub>τ³ (τ = t −
                                t<sub>i</sub>)</p>
                            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:8px;">
                                <a id="downloadPoints" href="#" download>Download Points (CSV)</a>
                                <a id="downloadJSON" href="#" download>Download Spline (JSON)</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <section id="descriptionSection" aria-live="polite" aria-label="Kolam Description Panel"
                style="margin-bottom: 100px">
                <div class="desc-header">
                    <h2>3. Kolam Description</h2>
                    <div class="narration-mode" role="group" aria-label="Narration Mode Selection">
                        <fieldset>
                            <legend>NARRATION MODE</legend>
                            <label><input type="radio" name="nmode" value="offline" checked /> Offline (no AI)</label>
                            <label><input type="radio" name="nmode" value="auto" /> Auto (AI w/ fallback)</label>
                            <label><input type="radio" name="nmode" value="ai" /> Force AI</label>
                        </fieldset>
                    </div>
                    <span id="narrationSource" class="source-tag" hidden></span>
                </div>
                <pre id="kolamDescription"></pre>
            </section>
        </div>
    </div>

    <script src="/assets/kolamtrace.js"></script>
</body>

</html>